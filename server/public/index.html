<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <title>å¤‡å“å¤‡ä»¶ä»“åº“ç®¡ç†ç³»ç»Ÿ | Spare Parts Warehouse Management System</title>
    <style>
        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1a365d;
            --secondary-color: #2d3748;
            --accent-color: #3182ce;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --error-color: #e53e3e;
            --background-color: #f7fafc;
            --surface-color: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Navbar */
        .navbar {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: var(--spacing-md) var(--spacing-xl);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .navbar-logo {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.25rem;
        }

        .navbar-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .navbar-subtitle {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-top: var(--spacing-xs);
        }

        /* Main content */
        .main-content {
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-xl);
            width: 100%;
        }

        /* Page tabs */
        .page-tabs {
            display: flex;
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xs);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .page-tab {
            flex: 1;
            padding: var(--spacing-md);
            text-align: center;
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .page-tab.active {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .page-tab:hover:not(.active) {
            background: var(--background-color);
            color: var(--text-primary);
        }

        /* Page content */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, #fafbfc 0%, #f8f9fa 100%);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .card-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .card-body {
            padding: var(--spacing-lg);
        }

        /* Grid */
        .grid {
            display: grid;
            gap: var(--spacing-lg);
        }

        .grid-cols-1 { grid-template-columns: 1fr; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }

        @media (max-width: 768px) {
            .grid-cols-2, .grid-cols-3, .grid-cols-4 {
                grid-template-columns: 1fr;
            }
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            min-height: 44px;
            text-decoration: none;
            font-family: inherit;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: none;
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .btn {
            box-shadow: none !important;
        }

        .btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: none !important;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
            box-shadow: none !important;
        }

        .btn-outline {
            background: transparent;
            color: var(--text-secondary);
            border-color: var(--border-color);
            box-shadow: none !important;
        }

        .btn-outline:hover {
            background: var(--background-color);
            color: var(--text-primary);
            box-shadow: none !important;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background: #2c5282;
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Forms */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
            font-size: 0.875rem;
        }

        .form-control {
            width: 100%;
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            background: var(--surface-color);
            color: var(--text-primary);
            transition: all 0.2s ease;
            min-height: 44px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }

        /* Stats */
        .stat-card {
            text-align: center;
            padding: var(--spacing-xl);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-change {
            font-size: 0.75rem;
            margin-top: var(--spacing-xs);
            font-weight: 500;
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--error-color);
        }

        /* Search interface */
        .search-interface {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-xl);
        }

        @media (max-width: 768px) {
            .search-interface {
                grid-template-columns: 1fr;
            }
        }

        .search-box {
            position: relative;
            margin-bottom: var(--spacing-lg);
        }

        .search-input {
            padding-left: 3rem;
        }

        .search-icon {
            position: absolute;
            left: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 var(--radius-md) var(--radius-md);
            box-shadow: var(--shadow-lg);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-results.show {
            display: block;
        }

        .search-result-item {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .search-result-item:hover {
            background: var(--background-color);
        }

        .search-result-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .search-result-details {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: var(--spacing-xs);
        }

        .search-result-stock {
            font-weight: 600;
            float: right;
        }

        .search-result-stock.low {
            color: var(--error-color);
        }

        .search-result-stock.normal {
            color: var(--success-color);
        }

        /* Product info */
        .product-info {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            border: 1px solid var(--border-color);
        }

        .product-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .product-field:last-child {
            border-bottom: none;
        }

        .product-field-label {
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .product-field-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .stock-value {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .stock-value.low {
            color: var(--error-color);
        }

        .stock-value.normal {
            color: var(--success-color);
        }

        /* Product list */
        .product-list-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .product-list-item:hover {
            background: var(--background-color);
            transform: translateX(2px);
        }

        .product-list-item:last-child {
            border-bottom: none;
        }

        .product-avatar {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-lg);
            background: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: var(--spacing-md);
        }

        .product-info-text {
            flex: 1;
        }

        .product-name {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .product-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .product-stock {
            text-align: right;
        }

        .product-stock-number {
            font-weight: 700;
            font-size: 1.125rem;
        }

        .product-stock-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: var(--spacing-xs);
        }

        .product-stock-number.low {
            color: var(--error-color);
        }

        .product-stock-number.normal {
            color: var(--success-color);
        }

        /* Transaction item */
        .transaction-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.2s ease;
        }

        .transaction-item:hover {
            background: var(--background-color);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-type {
            width: 60px;
            height: 28px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            margin-right: var(--spacing-md);
        }

        .transaction-type.in {
            background: var(--success-color);
        }

        .transaction-type.out {
            background: var(--error-color);
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-name {
            font-weight: 500;
            margin-bottom: var(--spacing-xs);
        }

        .transaction-details {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .transaction-quantity {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xl) * 2;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.125rem;
            margin-bottom: var(--spacing-sm);
        }

        .empty-state-subtext {
            font-size: 0.875rem;
        }

        /* Loading state */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-xl);
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Quantity control */
        .quantity-control {
            margin-top: var(--spacing-lg);
        }

        .quantity-input-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-sm);
        }

        .btn-quantity {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            background: var(--surface-color);
            color: var(--primary-color);
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-quantity:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }

        .quantity-display {
            width: 80px;
            height: 50px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            text-align: center;
            font-size: 1.25rem;
            font-weight: bold;
            background: var(--surface-color);
            color: var(--text-primary);
        }

        /* Operation buttons */
        .operation-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        .operation-mode-toggle {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: center;
        }

        .btn-lg {
            padding: var(--spacing-lg) var(--spacing-xl);
            font-size: 1rem;
            min-height: 52px;
        }

        .btn-sm {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.75rem;
            min-height: 36px;
        }

        /* Signature section */
        .signature-section {
            margin: var(--spacing-lg) 0;
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--background-color);
        }

        .signature-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .signature-input-group input:last-child {
            grid-column: 1 / -1;
        }

        .signature-canvas {
            width: 100%;
            height: 150px;
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-md);
            background: white;
            cursor: crosshair;
            display: block;
            margin-bottom: var(--spacing-sm);
        }

        .signature-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Message styles */
        .message {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 3000;
            max-width: 300px;
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            color: white;
            animation: slideIn 0.3s ease;
        }

        .message.success {
            background: var(--success-color);
        }

        .message.error {
            background: var(--error-color);
        }

        .message.warning {
            background: var(--warning-color);
        }

        .message.info {
            background: var(--accent-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Filter buttons */
        .filter-buttons {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: center;
        }

        .filter-buttons .btn.active {
            background: var(--primary-color);
            color: white;
        }

        /* Progress bars */
        .progress-bar-container {
            width: 100%;
            height: 4px;
            background: var(--background-color);
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin-top: var(--spacing-sm);
        }

        .progress-bar {
            height: 100%;
            background: var(--accent-color);
            transition: width 0.3s ease;
            border-radius: var(--radius-sm);
        }

        /* Report sections */
        .report-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }

        .report-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-sm);
        }



        .init-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm);
            background: rgba(255, 255, 255, 0.5);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
        }

        .init-stat span:first-child {
            color: var(--text-secondary);
        }

        .init-stat span:last-child {
            font-weight: 600;
            color: var(--text-primary);
        }

        .init-recommendation {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
            padding: var(--spacing-sm);
            background: rgba(255, 255, 255, 0.7);
            border-radius: var(--radius-sm);
            font-style: italic;
        }

        /* Category management styles */
        .category-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--surface-color);
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }

        .category-item:last-child {
            border-bottom: none;
        }

        .category-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .category-description {
            font-size: 0.75rem;
            color: var(--text-muted);
        }



        .report-item:last-child {
            margin-bottom: 0;
        }

        .report-item-label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .report-item-value {
            font-weight: 600;
            color: var(--accent-color);
        }

        .report-item-value.warning {
            color: var(--warning-color);
        }

        .report-item-value.error {
            color: var(--error-color);
        }

        /* Category distribution */
        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--border-color);
        }

        .category-item:last-child {
            border-bottom: none;
        }

        .category-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .category-count {
            font-weight: 600;
            color: var(--accent-color);
        }

        /* Transaction history in reports */
        .transaction-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            background: var(--background-color);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
        }

        .transaction-summary-item {
            text-align: center;
        }

        .transaction-summary-number {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .transaction-summary-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: var(--spacing-xs);
        }

        .transaction-summary-in {
            color: var(--success-color);
        }

        .transaction-summary-out {
            color: var(--error-color);
        }

        /* ...existing styles... */
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="navbar-content">
                <div class="navbar-brand">
                    <div class="navbar-logo">å¤‡</div>
                    <div>
                        <div class="navbar-title">å¤‡å“å¤‡ä»¶ä»“åº“ç®¡ç†ç³»ç»Ÿ</div>
                        <div class="navbar-subtitle">Spare Parts Warehouse Management System</div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main content -->
        <main class="main-content">
            <!-- Page tabs -->
            <div class="page-tabs">
                <button class="page-tab active" onclick="switchPage('scanner')">
                    ğŸ” å¿«é€Ÿæœç´¢
                </button>
                <button class="page-tab" onclick="switchPage('inventory')">
                    ğŸ“¦ åº“å­˜ç®¡ç†
                </button>
                <button class="page-tab" onclick="switchPage('reports')">
                    ğŸ“Š æŠ¥å‘Šä¸­å¿ƒ
                </button>
                <button class="page-tab" onclick="switchPage('settings')">
                    âš™ï¸ ç³»ç»Ÿè®¾ç½®
                </button>
            </div>

            <!-- Scanner page -->
            <div id="scanner-page" class="page-content active">
                <!-- Statistics overview -->
                <div class="grid grid-cols-4 mb-4">
                    <div class="card">
                        <div class="stat-card">
                            <div class="stat-number" id="totalProducts">-</div>
                            <div class="stat-label">æ€»äº§å“æ•°</div>
                            <div class="stat-change positive" id="totalProductsChange">-</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="stat-card">
                            <div class="stat-number" id="lowStockItems">-</div>
                            <div class="stat-label">ä½åº“å­˜è­¦å‘Š</div>
                            <div class="stat-change negative">éœ€è¦è¡¥è´§</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="stat-card">
                            <div class="stat-number" id="todayTransactions">-</div>
                            <div class="stat-label">ä»Šæ—¥äº¤æ˜“</div>
                            <div class="stat-change positive" id="todayTransactionsChange">-</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="stat-card">
                            <div class="stat-number" id="totalValue">-</div>
                            <div class="stat-label">åº“å­˜æ€»å€¼</div>
                            <div class="stat-change positive" id="totalValueChange">-</div>
                        </div>
                    </div>
                </div>

                <!-- Search interface -->
                <div class="search-interface">
                    <!-- Search operations -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">äº§å“æœç´¢</div>
                            <div class="card-subtitle">è¾“å…¥äº§å“åç§°ã€æ¡ç æˆ–ç±»åˆ«è¿›è¡Œæœç´¢</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">æœç´¢äº§å“</label>
                                <div class="search-box">
                                    <div class="search-icon">ğŸ”</div>
                                    <input 
                                        type="text" 
                                        id="quickSearchInput" 
                                        class="form-control search-input"
                                        placeholder="è¾“å…¥äº§å“åç§°ã€æ¡ç æˆ–ç±»åˆ«..."
                                        autocomplete="off"
                                        autofocus
                                        oninput="performQuickSearch()"
                                        onfocus="performQuickSearch()"
                                        onkeyup="handleQuickSearchInput(event)"
                                    />
                                    <div id="quickSearchResults" class="search-results">
                                        <!-- Search results will be populated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="operation-buttons">
                                <button class="btn btn-success btn-lg" id="btnIn" onclick="setOperation('IN')">
                                    å…¥åº“æ“ä½œ
                                </button>
                                <button class="btn btn-outline btn-lg" id="btnOut" onclick="setOperation('OUT')">
                                    å‡ºåº“æ“ä½œ
                                </button>
                            </div>
                            
                            <!-- Operation Mode Toggle -->
                            <div class="form-group">
                                <label class="form-label">æ“ä½œæ¨¡å¼</label>
                                <div class="operation-mode-toggle">
                                    <button class="btn btn-outline btn-sm active" id="singleMode" onclick="setOperationMode('single')">
                                        å•å“æ¨¡å¼
                                    </button>
                                    <button class="btn btn-outline btn-sm" id="batchMode" onclick="setOperationMode('batch')">
                                        æ‰¹é‡æ¨¡å¼
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Batch Operations Panel -->
                            <div id="batchOperationsPanel" class="batch-operations-panel" style="display: none;">
                                <div class="batch-header">
                                    <h4>æ‰¹é‡æ“ä½œ</h4>
                                    <button class="btn btn-outline btn-sm" onclick="clearBatchList()">
                                        ğŸ—‘ï¸ æ¸…ç©ºåˆ—è¡¨
                                    </button>
                                </div>
                                <div id="batchProductList" class="batch-product-list">
                                    <!-- Batch products will be added here -->
                                </div>
                                
                                <!-- Signature section for batch operations -->
                                <div class="signature-section">
                                    <label class="form-label">æ“ä½œç­¾å</label>
                                    <div class="signature-input-group">
                                        <input type="text" id="batchRequesterName" class="form-control" placeholder="è¯·è¾“å…¥æ“ä½œäººå‘˜å§“å" />
                                        <input type="text" id="batchRequesterDept" class="form-control" placeholder="è¯·è¾“å…¥éƒ¨é—¨" />
                                        <input type="text" id="batchPurpose" class="form-control" placeholder="è¯·è¾“å…¥æ“ä½œç›®çš„" />
                                    </div>
                                    <canvas id="signatureCanvas" class="signature-canvas" width="400" height="150"></canvas>
                                    <div class="signature-controls">
                                        <button class="btn btn-outline btn-sm" onclick="clearSignature()">æ¸…é™¤ç­¾å</button>
                                        <small class="text-muted">è¯·åœ¨ä¸Šæ–¹åŒºåŸŸå†…ç­¾å</small>
                                    </div>
                                </div>
                                
                                <div class="batch-actions">
                                    <button class="btn btn-primary btn-lg" onclick="executeBatchOperation()">
                                        æ‰§è¡Œæ‰¹é‡æ“ä½œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Product info display -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">äº§å“ä¿¡æ¯</div>
                            <div class="card-subtitle">é€‰æ‹©çš„äº§å“è¯¦ç»†ä¿¡æ¯</div>
                        </div>
                        <div class="card-body">
                            <div id="productDisplay" class="hidden">
                                <div class="product-info">
                                    <div class="product-field">
                                        <span class="product-field-label">äº§å“åç§°</span>
                                        <span class="product-field-value" id="productName">-</span>
                                    </div>
                                    <div class="product-field">
                                        <span class="product-field-label">äº§å“æ¡ç </span>
                                        <span class="product-field-value" id="productBarcode">-</span>
                                    </div>
                                    <div class="product-field">
                                        <span class="product-field-label">äº§å“ç±»åˆ«</span>
                                        <span class="product-field-value" id="productCategory">-</span>
                                    </div>
                                    <div class="product-field">
                                        <span class="product-field-label">å­˜å‚¨ä½ç½®</span>
                                        <span class="product-field-value" id="productLocation">-</span>
                                    </div>
                                    <div class="product-field">
                                        <span class="product-field-label">å½“å‰åº“å­˜</span>
                                        <span class="product-field-value stock-value" id="productStock">-</span>
                                    </div>
                                </div>
                                
                                <div class="quantity-control">
                                    <label class="form-label">æ“ä½œæ•°é‡</label>
                                    <div class="quantity-input-group">
                                        <button class="btn-quantity" onclick="decreaseQuantity()">ï¼</button>
                                        <input type="number" id="quantityInput" class="quantity-display" value="1" min="1" readonly>
                                        <button class="btn-quantity" onclick="increaseQuantity()">ï¼‹</button>
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary btn-lg w-full mt-4" onclick="executeTransaction()">
                                    âœ… ç¡®è®¤æ“ä½œ
                                </button>
                            </div>
                            
                            <div id="noProductDisplay" class="empty-state">
                                <div class="empty-state-icon">ğŸ”</div>
                                <div class="empty-state-text">è¯·æœç´¢äº§å“</div>
                                <div class="empty-state-subtext">åœ¨å·¦ä¾§æœç´¢æ¡†ä¸­è¾“å…¥äº§å“ä¿¡æ¯</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent transactions -->
                <div class="card mt-4">
                    <div class="card-header">
                        <div class="card-title">æœ€è¿‘äº¤æ˜“è®°å½•</div>
                        <div class="card-subtitle">æ˜¾ç¤ºæœ€è¿‘5æ¡å‡ºå…¥åº“æ“ä½œ</div>
                    </div>
                    <div class="card-body">
                        <div id="transactionsList">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory page -->
            <div id="inventory-page" class="page-content">
                <!-- Inventory controls -->
                <div class="grid grid-cols-3 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <div class="search-box">
                                <div class="search-icon">ğŸ”</div>
                                <input 
                                    type="text" 
                                    id="searchInput" 
                                    class="form-control search-input"
                                    placeholder="æœç´¢äº§å“åç§°ã€æ¡ç æˆ–ç±»åˆ«..."
                                    oninput="searchProducts()"
                                />
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="filter-buttons">
                                <button class="btn btn-outline btn-sm" id="filterAll" onclick="filterProducts('all')">
                                    ï¿½ å…¨éƒ¨äº§å“
                                </button>
                                <button class="btn btn-outline btn-sm" id="filterLowStock" onclick="filterProducts('lowStock')">
                                    âš ï¸ ä½åº“å­˜
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="inventory-actions">
                                <button class="btn btn-primary btn-sm" onclick="generateBarcode()">
                                    ğŸ“‹ ç”Ÿæˆæ¡ç 
                                </button>
                                <button class="btn btn-success btn-sm" onclick="addNewProduct()">
                                    â• æ–°å¢äº§å“
                                </button>
                                <button class="btn btn-info btn-sm" onclick="importData()">
                                    ï¿½ å¯¼å…¥æ•°æ®
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="exportInventory()">
                                    ğŸ“Š å¯¼å‡ºæ•°æ®
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product list -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">äº§å“åº“å­˜åˆ—è¡¨</div>
                        <div class="card-subtitle">ç®¡ç†æ‰€æœ‰äº§å“çš„åº“å­˜ä¿¡æ¯</div>
                    </div>
                    <div class="card-body">
                        <div id="productItems">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports page -->
            <div id="reports-page" class="page-content">
                <!-- Report statistics -->
                <div class="grid grid-cols-4 mb-4">
                    <div class="card">
                        <div class="stat-card">
                            <div class="stat-number" id="reportTotalProducts">-</div>
                            <div class="stat-label">äº§å“æ€»æ•°</div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="reportTotalProductsProgress"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="stat-card">
                            <div class="stat-number" id="reportTodayTransactions">-</div>
                            <div class="stat-label">ä»Šæ—¥äº¤æ˜“</div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="reportTodayTransactionsProgress"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="stat-card">
                            <div class="stat-number" id="reportLowStockItems">-</div>
                            <div class="stat-label">ä½åº“å­˜è­¦å‘Š</div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="reportLowStockProgress"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="stat-card">
                            <div class="stat-number" id="reportInventoryHealth">-</div>
                            <div class="stat-label">åº“å­˜å¥åº·åº¦</div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="reportHealthProgress"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Report sections -->
                <div class="grid grid-cols-2 mb-4">
                    <!-- Inventory status -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">åº“å­˜çŠ¶æ€åˆ†æ</div>
                            <div class="card-subtitle">äº§å“åº“å­˜åˆ†å¸ƒå’ŒçŠ¶æ€</div>
                        </div>
                        <div class="card-body">
                            <div id="inventoryStatusReport">
                                <div class="loading">
                                    <div class="spinner"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category distribution -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">ç±»åˆ«åˆ†å¸ƒ</div>
                            <div class="card-subtitle">äº§å“åˆ†ç±»ç»Ÿè®¡</div>
                        </div>
                        <div class="card-body">
                            <div id="categoryDistributionReport">
                                <div class="loading">
                                    <div class="spinner"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transaction history -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">äº¤æ˜“å†å²åˆ†æ</div>
                        <div class="card-subtitle">æœ€è¿‘äº¤æ˜“è®°å½•å’Œè¶‹åŠ¿</div>
                    </div>
                    <div class="card-body">
                        <div id="transactionHistoryReport">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Report actions -->
                <div class="card mt-4">
                    <div class="card-header">
                        <div class="card-title">æŠ¥å‘Šæ“ä½œ</div>
                        <div class="card-subtitle">ç”Ÿæˆå’Œå¯¼å‡ºæŠ¥å‘Š</div>
                    </div>
                    <div class="card-body">
                        <div class="report-actions">
                            <button class="btn btn-primary btn-lg" onclick="generateReport()">
                                ğŸ“Š ç”Ÿæˆç»¼åˆæŠ¥å‘Š
                            </button>
                            <button class="btn btn-secondary btn-lg" onclick="exportReport()">
                                ğŸ“ å¯¼å‡ºæŠ¥å‘Š
                            </button>
                            <button class="btn btn-outline btn-lg" onclick="refreshReports()">
                                ğŸ”„ åˆ·æ–°æ•°æ®
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings page -->
            <div id="settings-page" class="page-content">
                <!-- Data Management Section -->
                <div class="grid grid-cols-2 mb-4">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">æ•°æ®ç®¡ç†</div>
                            <div class="card-subtitle">æ•°æ®å¤‡ä»½å’Œä¼ è¾“é…ç½®</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group mb-4">
                                <label class="form-label">æ•°æ®å¤‡ä»½</label>
                                <button class="btn btn-primary btn-block" onclick="backupData()">
                                    ğŸ’¾ ç«‹å³å¤‡ä»½æ•°æ®
                                </button>
                                <small class="text-muted">ä¸Šæ¬¡å¤‡ä»½: 2024-12-09 14:30</small>
                            </div>

                            <div class="form-group mb-4">
                                <label class="form-label">æ•°æ®å¯¼å…¥å¯¼å‡º</label>
                                <div class="btn-group-vertical w-100">
                                    <button class="btn btn-success mb-2" onclick="downloadTemplate()">
                                        ğŸ“„ ä¸‹è½½å¯¼å…¥æ¨¡æ¿
                                    </button>
                                    <button class="btn btn-info mb-2" onclick="importDataFromFile()">
                                        ğŸ“‚ å¯¼å…¥äº§å“æ•°æ®
                                    </button>
                                    <input type="file" id="importFileInput" accept=".csv,.xlsx,.xls" style="display: none;" onchange="handleFileImport(this)">
                                    <button class="btn btn-secondary mb-2" onclick="exportAllProducts()">
                                        ğŸ“Š å¯¼å‡ºæ‰€æœ‰äº§å“
                                    </button>
                                </div>
                            </div>


                            
                            <div class="form-group">
                                <label class="form-label">æ•°æ®ä¼ è¾“</label>
                                <input type="text" class="form-control" id="apiEndpoint" placeholder="APIç«¯ç‚¹åœ°å€" value="http://localhost:3004/api">
                                <button class="btn btn-secondary mt-2" onclick="testConnection()">
                                    ğŸ”— æµ‹è¯•è¿æ¥
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Category Management -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">äº§å“ç±»åˆ«ç®¡ç†</div>
                            <div class="card-subtitle">æ·»åŠ å’Œç®¡ç†äº§å“ç±»åˆ«</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group mb-4">
                                <label class="form-label">æ–°å»ºç±»åˆ«</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="newCategoryName" placeholder="è¾“å…¥ç±»åˆ«åç§°">
                                    <button class="btn btn-primary" onclick="addCategory()">
                                        â• æ·»åŠ ç±»åˆ«
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ç°æœ‰ç±»åˆ«</label>
                                <div id="categoryList" class="category-list">
                                    <!-- Categories will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Password Management -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ç®¡ç†å‘˜å¯†ç ç®¡ç†</div>
                        <div class="card-subtitle">ä¿®æ”¹ç®¡ç†å‘˜ç™»å½•å¯†ç </div>
                    </div>
                    <div class="card-body">
                        <div class="grid grid-cols-3">
                            <div class="form-group">
                                <label class="form-label">å½“å‰å¯†ç </label>
                                <input type="password" class="form-control" id="currentPassword" placeholder="è¾“å…¥å½“å‰å¯†ç ">
                            </div>
                            <div class="form-group">
                                <label class="form-label">æ–°å¯†ç </label>
                                <input type="password" class="form-control" id="newPassword" placeholder="è¾“å…¥æ–°å¯†ç ">
                                <small class="text-muted">å¯†ç é•¿åº¦è‡³å°‘8ä½</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ç¡®è®¤å¯†ç </label>
                                <input type="password" class="form-control" id="confirmPassword" placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç ">
                            </div>
                        </div>
                        <div class="form-actions mt-4">
                            <button class="btn btn-primary" onclick="changePassword()">
                                ğŸ” ä¿®æ”¹å¯†ç 
                            </button>
                            <button class="btn btn-outline" onclick="clearPasswordForm()">
                                ğŸ—‘ï¸ æ¸…ç©ºè¡¨å•
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global variables
        let currentOperation = 'IN';
        let currentProduct = null;
        let currentPage = 'scanner';
        let products = [];
        let transactions = [];
        let categories = [];
        let operationMode = 'single'; // 'single' or 'batch'
        let batchProducts = []; // Array to store batch operation products

        // API base URL
        const API_BASE = '/api';

        // Utility functions
        function showMessage(message, type = 'info') {
            console.log('showMessage called:', message, type);
            const messageElement = document.createElement('div');
            messageElement.className = `message ${type}`;
            messageElement.textContent = message;
            
            document.body.appendChild(messageElement);
            
            setTimeout(() => {
                messageElement.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(messageElement)) {
                        document.body.removeChild(messageElement);
                    }
                }, 300);
            }, 3000);
        }

        async function apiRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API request failed:', error);
                showMessage(`APIé”™è¯¯: ${error.message}`, 'error');
                throw error;
            }
        }

        // Data loading functions
        async function loadProducts() {
            try {
                const data = await apiRequest('/products');
                products = data;
                updateProductList();
                updateStats();
            } catch (error) {
                console.error('Failed to load products:', error);
            }
        }

        async function loadTransactions() {
            try {
                const data = await apiRequest('/transactions?limit=5');
                transactions = data;
                updateTransactionsList();
            } catch (error) {
                console.error('Failed to load transactions:', error);
            }
        }

        async function loadCategories() {
            try {
                const data = await apiRequest('/categories');
                categories = data;
                updateCategoryList();
            } catch (error) {
                console.error('Failed to load categories:', error);
            }
        }

        async function loadStats() {
            try {
                const stats = await apiRequest('/products/stats');
                updateStatsDisplay(stats);
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        function updateStatsDisplay(stats) {
            document.getElementById('totalProducts').textContent = stats.totalProducts || 0;
            document.getElementById('lowStockItems').textContent = stats.lowStockItems || 0;
            document.getElementById('todayTransactions').textContent = stats.todayTransactions || 0;
            document.getElementById('totalValue').textContent = `Â¥${(stats.totalValue || 0).toLocaleString()}`;
        }

        function updateTransactionsList() {
            const container = document.getElementById('transactionsList');
            
            if (!transactions || transactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“</div>
                        <div class="empty-state-text">æš‚æ— äº¤æ˜“è®°å½•</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = transactions.map(transaction => `
                <div class="transaction-item">
                    <div class="transaction-type ${transaction.type.toLowerCase()}">
                        ${transaction.type}
                    </div>
                    <div class="transaction-info">
                        <div class="transaction-name">${transaction.product_name}</div>
                        <div class="transaction-details">
                            æ•°é‡: ${transaction.quantity} | ${new Date(transaction.created_at).toLocaleString()}
                        </div>
                    </div>
                    <div class="transaction-quantity">${transaction.quantity}</div>
                </div>
            `).join('');
        }

        function updateProductList() {
            const container = document.getElementById('productItems');
            
            if (!products || products.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¦</div>
                        <div class="empty-state-text">æš‚æ— äº§å“</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = products.map(product => `
                <div class="product-list-item" onclick="showProductDetails(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                    <div class="product-avatar">${product.name.charAt(0)}</div>
                    <div class="product-info-text">
                        <div class="product-name">${product.name}</div>
                        <div class="product-meta">æ¡ç : ${product.barcode} | ç±»åˆ«: ${product.category_name || 'æœªåˆ†ç±»'}</div>
                    </div>
                    <div class="product-stock">
                        <div class="product-stock-number ${product.stock <= product.min_stock ? 'low' : 'normal'}">
                            ${product.stock}
                        </div>
                        <div class="product-stock-label">åº“å­˜</div>
                    </div>
                </div>
            `).join('');
        }

        function showProductDetails(product) {
            showMessage(`äº§å“è¯¦æƒ…: ${product.name}`, 'info');
        }

        // Page switching
        function switchPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active state from all tabs
            document.querySelectorAll('.page-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show target page
            document.getElementById(pageId + '-page').classList.add('active');
            
            // Set active tab
            event.target.classList.add('active');
            
            currentPage = pageId;
        }

        // Inventory functions
        function searchProducts() {
            // Implementation for inventory search
            showMessage('åº“å­˜æœç´¢åŠŸèƒ½å¼€å‘ä¸­', 'info');
        }

        function filterProducts(filter) {
            // Implementation for product filtering
            showMessage(`åˆ‡æ¢åˆ°${filter === 'all' ? 'å…¨éƒ¨' : 'ä½åº“å­˜'}ç­›é€‰`, 'info');
        }

        function refreshInventory() {
            loadProducts();
            showMessage('åº“å­˜æ•°æ®å·²åˆ·æ–°', 'success');
        }

        function exportInventory() {
            showMessage('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­', 'info');
        }

        // Reports functions
        function generateReport() {
            showMessage('æŠ¥å‘Šç”ŸæˆåŠŸèƒ½å¼€å‘ä¸­', 'info');
        }

        function exportReport() {
            showMessage('æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­', 'info');
        }

        function refreshReports() {
            showMessage('æŠ¥å‘Šæ•°æ®å·²åˆ·æ–°', 'success');
        }

        // Operation mode functions
        function setOperationMode(mode) {
            console.log('setOperationMode called with:', mode);
            operationMode = mode;
            
            // Update UI
            const singleMode = document.getElementById('singleMode');
            const batchMode = document.getElementById('batchMode');
            
            if (singleMode && batchMode) {
                singleMode.classList.toggle('active', mode === 'single');
                batchMode.classList.toggle('active', mode === 'batch');
                console.log('Mode button styles updated successfully');
            } else {
                console.error('Mode button elements not found:', { singleMode: !!singleMode, batchMode: !!batchMode });
            }
            
            // Show/hide batch operations panel
            const batchPanel = document.getElementById('batchOperationsPanel');
            if (batchPanel) {
                if (mode === 'batch') {
                    batchPanel.style.display = 'block';
                    updateBatchProductList();
                } else {
                    batchPanel.style.display = 'none';
                }
            } else {
                console.error('Batch operations panel not found');
            }
            
            showMessage(`åˆ‡æ¢åˆ°${mode === 'single' ? 'å•å“' : 'æ‰¹é‡'}æ¨¡å¼`, 'info');
        }

        // Batch operations functions
        function addToBatch(product) {
            if (!product) return;
            
            // Check if product already exists in batch
            const existingIndex = batchProducts.findIndex(p => p.id === product.id);
            if (existingIndex !== -1) {
                showMessage('è¯¥äº§å“å·²åœ¨æ‰¹é‡åˆ—è¡¨ä¸­', 'warning');
                return;
            }
            
            // Add product to batch with default quantity of 1
            batchProducts.push({
                ...product,
                batchQuantity: 1
            });
            
            updateBatchProductList();
            showMessage(`å·²æ·»åŠ  ${product.name} åˆ°æ‰¹é‡åˆ—è¡¨`, 'success');
        }

        function removeFromBatch(productId) {
            batchProducts = batchProducts.filter(p => p.id !== productId);
            updateBatchProductList();
            showMessage('å·²ä»æ‰¹é‡åˆ—è¡¨ç§»é™¤', 'success');
        }

        function updateBatchQuantity(productId, quantity) {
            const product = batchProducts.find(p => p.id === productId);
            if (product) {
                product.batchQuantity = Math.max(1, parseInt(quantity) || 1);
                updateBatchProductList();
            }
        }

        function updateBatchProductList() {
            const container = document.getElementById('batchProductList');
            
            if (batchProducts.length === 0) {
                container.innerHTML = `
                    <div class="batch-empty-state">
                        <div class="batch-empty-state-icon">ğŸ›’</div>
                        <div>æš‚æ— äº§å“</div>
                        <div style="font-size: 12px; margin-top: 4px;">æœç´¢å¹¶é€‰æ‹©äº§å“æ·»åŠ åˆ°æ‰¹é‡åˆ—è¡¨</div>
                    </div>
                `;
                return;
            }
            
            // Generate batch summary
            const totalItems = batchProducts.length;
            const totalQuantity = batchProducts.reduce((sum, p) => sum + p.batchQuantity, 0);
            
            container.innerHTML = `
                <div class="batch-summary">
                    <div class="batch-summary-item">
                        <span>äº§å“ç§ç±»:</span>
                        <span>${totalItems}</span>
                    </div>
                    <div class="batch-summary-item">
                        <span>æ€»æ“ä½œæ•°é‡:</span>
                        <span>${totalQuantity}</span>
                    </div>
                </div>
                ${batchProducts.map(product => `
                    <div class="batch-product-item">
                        <div class="batch-product-info">
                            <div class="batch-product-name">${product.name}</div>
                            <div class="batch-product-details">
                                æ¡ç : ${product.barcode} | å½“å‰åº“å­˜: ${product.stock}
                            </div>
                        </div>
                        <div class="batch-quantity-control">
                            <button class="btn-quantity" onclick="updateBatchQuantity('${product.id}', ${Math.max(1, product.batchQuantity - 1)})">ï¼</button>
                            <input type="number" class="batch-quantity-input" value="${product.batchQuantity}" 
                                   min="1" onchange="updateBatchQuantity('${product.id}', this.value)">
                            <button class="btn-quantity" onclick="updateBatchQuantity('${product.id}', ${product.batchQuantity + 1})">ï¼‹</button>
                            <button class="batch-remove-btn" onclick="removeFromBatch('${product.id}')">ç§»é™¤</button>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function clearBatchList() {
            if (batchProducts.length === 0) {
                showMessage('æ‰¹é‡åˆ—è¡¨å·²ç»ä¸ºç©º', 'info');
                return;
            }
            
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰¹é‡åˆ—è¡¨å—ï¼Ÿ')) {
                batchProducts = [];
                updateBatchProductList();
                showMessage('æ‰¹é‡åˆ—è¡¨å·²æ¸…ç©º', 'success');
            }
        }

        async function executeBatchOperation() {
            if (batchProducts.length === 0) {
                showMessage('æ‰¹é‡åˆ—è¡¨ä¸ºç©ºï¼Œè¯·å…ˆæ·»åŠ äº§å“', 'error');
                return;
            }
            
            // Check if signature information is provided
            const requesterName = document.getElementById('batchRequesterName').value.trim();
            const requesterDept = document.getElementById('batchRequesterDept').value.trim();
            const purpose = document.getElementById('batchPurpose').value.trim();
            
            if (!requesterName) {
                showMessage('è¯·è¾“å…¥æ“ä½œäººå‘˜å§“å', 'error');
                return;
            }
            
            if (!requesterDept) {
                showMessage('è¯·è¾“å…¥éƒ¨é—¨ä¿¡æ¯', 'error');
                return;
            }
            
            if (!purpose) {
                showMessage('è¯·è¾“å…¥æ“ä½œç›®çš„', 'error');
                return;
            }
            
            if (!signatureData) {
                showMessage('è¯·å…ˆè¿›è¡Œç­¾å', 'error');
                return;
            }
            
            const operationText = currentOperation === 'IN' ? 'å…¥åº“' : 'å‡ºåº“';
            const totalItems = batchProducts.length;
            const totalQuantity = batchProducts.reduce((sum, p) => sum + p.batchQuantity, 0);
            
            if (!confirm(`ç¡®å®šè¦æ‰§è¡Œæ‰¹é‡${operationText}æ“ä½œå—ï¼Ÿ\n\näº§å“ç§ç±»: ${totalItems}\næ€»æ“ä½œæ•°é‡: ${totalQuantity}\næ“ä½œäºº: ${requesterName}\néƒ¨é—¨: ${requesterDept}`)) {
                return;
            }
            
            try {
                showMessage(`æ­£åœ¨æ‰§è¡Œæ‰¹é‡${operationText}æ“ä½œ...`, 'info');
                
                // Execute batch operations
                const results = await Promise.all(
                    batchProducts.map(async (product) => {
                        try {
                            const requestData = {
                                product_id: product.id,
                                type: currentOperation,
                                quantity: product.batchQuantity,
                                requester_name: requesterName,
                                requester_department: requesterDept,
                                purpose: purpose,
                                signature: signatureData
                            };
                            
                            console.log('Sending batch request:', requestData);
                            
                            const result = await apiRequest('/transactions', {
                                method: 'POST',
                                body: JSON.stringify(requestData)
                            });
                            return { success: true, product: product.name, result };
                        } catch (error) {
                            console.error('Batch operation failed for product:', product.name, error);
                            return { success: false, product: product.name, error: error.message };
                        }
                    })
                );
                
                // Process results
                const successful = results.filter(r => r.success);
                const failed = results.filter(r => !r.success);
                
                if (successful.length === results.length) {
                    showMessage(`æ‰¹é‡${operationText}æ“ä½œæˆåŠŸï¼å¤„ç†äº† ${successful.length} ä¸ªäº§å“`, 'success');
                    
                    // Clear batch list and form
                    batchProducts = [];
                    updateBatchProductList();
                    
                    // Clear signature form
                    document.getElementById('batchRequesterName').value = '';
                    document.getElementById('batchRequesterDept').value = '';
                    document.getElementById('batchPurpose').value = '';
                    clearSignature();
                    
                } else {
                    showMessage(`æ‰¹é‡æ“ä½œéƒ¨åˆ†æˆåŠŸï¼šæˆåŠŸ ${successful.length} ä¸ªï¼Œå¤±è´¥ ${failed.length} ä¸ª`, 'warning');
                    if (failed.length > 0) {
                        console.log('Failed operations:', failed);
                    }
                }
                
                // Refresh data
                await loadProducts();
                await loadTransactions();
                await loadStats();
                
            } catch (error) {
                console.error('Batch operation failed:', error);
                showMessage('æ‰¹é‡æ“ä½œå¤±è´¥', 'error');
            }
        }

        // Settings and data management functions
        


        // Data import/export functions
        function downloadTemplate() {
            try {
                // Create CSV template with correct headers matching database schema
                const headers = [
                    'name',           // äº§å“åç§° (å¿…å¡«)
                    'name_en',        // è‹±æ–‡åç§°
                    'barcode',        // æ¡ç 
                    'category_name',  // ç±»åˆ«åç§° (å¿…å¡«)
                    'location',       // å­˜æ”¾ä½ç½®
                    'supplier',       // ä¾›åº”å•†
                    'description',    // æè¿°
                    'stock',          // åº“å­˜æ•°é‡ (å¿…å¡«)
                    'min_stock',      // æœ€å°åº“å­˜
                    'current_unit_price'  // å•ä»·
                ];
                
                // Create sample data
                const sampleData = [
                    ['ç¤ºä¾‹äº§å“1', 'Sample Product 1', 'SP001', 'èºä¸', 'A1-01', 'ä¾›åº”å•†A', 'äº§å“æè¿°', '100', '10', '5.50'],
                    ['ç¤ºä¾‹äº§å“2', 'Sample Product 2', 'SP002', 'é‡‘å±', 'A1-02', 'ä¾›åº”å•†B', 'äº§å“æè¿°', '50', '5', '12.30'],
                    ['ç¤ºä¾‹äº§å“3', 'Sample Product 3', 'SP003', 'PPæè´¨', 'A1-03', 'ä¾›åº”å•†C', 'äº§å“æè¿°', '200', '20', '3.25']
                ];
                
                // Convert to CSV
                const csvContent = [headers, ...sampleData]
                    .map(row => row.map(field => `"${field}"`).join(','))
                    .join('\\n');
                
                // Create and download file
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `äº§å“å¯¼å…¥æ¨¡æ¿_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showMessage('å¯¼å…¥æ¨¡æ¿ä¸‹è½½æˆåŠŸ', 'success');
                
            } catch (error) {
                console.error('Template download failed:', error);
                showMessage('æ¨¡æ¿ä¸‹è½½å¤±è´¥', 'error');
            }
        }

        function importDataFromFile() {
            document.getElementById('importFileInput').click();
        }

        async function handleFileImport(input) {
            const file = input.files[0];
            if (!file) return;
            
            const confirmed = confirm(
                `ç¡®å®šè¦å¯¼å…¥æ–‡ä»¶ "${file.name}" å—ï¼Ÿ\n\n` +
                'å¯¼å…¥è¿‡ç¨‹ä¸­è¯·å‹¿å…³é—­é¡µé¢ã€‚\n' +
                'å»ºè®®åœ¨å¯¼å…¥å‰å…ˆå¤‡ä»½ç°æœ‰æ•°æ®ã€‚'
            );
            
            if (!confirmed) {
                input.value = '';
                return;
            }
            
            try {
                showMessage('æ­£åœ¨å¤„ç†æ–‡ä»¶ï¼Œè¯·ç¨å€™...', 'info');
                
                const formData = new FormData();
                formData.append('file', file);
                
                const response = await fetch('/api/products/import', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(
                        `å¯¼å…¥æˆåŠŸï¼\\n` +
                        `æ€»è®¡: ${result.total} æ¡\\n` +
                        `æˆåŠŸ: ${result.successful} æ¡\\n` +
                        `å¤±è´¥: ${result.failed} æ¡`,
                        'success'
                    );
                    
                    // Refresh data
                    await loadProducts();
                    await loadCategories();
                    await loadStats();
                } else {
                    showMessage(`å¯¼å…¥å¤±è´¥: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('File import failed:', error);
                showMessage('æ–‡ä»¶å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼', 'error');
            } finally {
                input.value = '';
            }
        }

        async function exportAllProducts() {
            try {
                showMessage('æ­£åœ¨å¯¼å‡ºäº§å“æ•°æ®...', 'info');
                
                const response = await fetch('/api/products/export', {
                    method: 'GET'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const blob = await response.blob();
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `äº§å“æ•°æ®å¯¼å‡º_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showMessage('äº§å“æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
                
            } catch (error) {
                console.error('Export failed:', error);
                showMessage('æ•°æ®å¯¼å‡ºå¤±è´¥', 'error');
            }
        }

        function backupData() {
            showMessage('æ•°æ®å¤‡ä»½åŠŸèƒ½å¼€å‘ä¸­', 'info');
        }

        function testConnection() {
            const endpoint = document.getElementById('apiEndpoint').value;
            showMessage(`æµ‹è¯•è¿æ¥: ${endpoint}`, 'info');
        }

        // Category management functions
        async function addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            if (!name) {
                showMessage('è¯·è¾“å…¥ç±»åˆ«åç§°', 'error');
                return;
            }
            
            try {
                await apiRequest('/categories', {
                    method: 'POST',
                    body: JSON.stringify({ name, description: name })
                });
                
                showMessage(`ç±»åˆ« "${name}" æ·»åŠ æˆåŠŸ`, 'success');
                document.getElementById('newCategoryName').value = '';
                await loadCategories();
                
            } catch (error) {
                console.error('Failed to add category:', error);
                showMessage('æ·»åŠ ç±»åˆ«å¤±è´¥', 'error');
            }
        }

        function updateCategoryList() {
            const container = document.getElementById('categoryList');
            
            if (!categories || categories.length === 0) {
                container.innerHTML = '<div class="text-muted">æš‚æ— ç±»åˆ«</div>';
                return;
            }
            
            container.innerHTML = categories.map(category => `
                <div class="category-item">
                    <span class="category-name">${category.name}</span>
                    <span class="category-description">${category.description || ''}</span>
                </div>
            `).join('');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial data
            Promise.all([
                loadProducts(),
                loadTransactions(),
                loadCategories(),
                loadStats()
            ]).then(() => {
                console.log('Application initialized successfully');
            }).catch(error => {
                console.error('Failed to initialize application:', error);
            });
        });

        // Search functionality
        async function performQuickSearch() {
            const searchTerm = document.getElementById('quickSearchInput').value.trim();
            const resultsContainer = document.getElementById('quickSearchResults');
            
            if (!searchTerm) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/products/search?q=${encodeURIComponent(searchTerm)}`);
                const results = await response.json();
                
                if (results.length === 0) {
                    resultsContainer.innerHTML = '<div style="padding: 12px; text-align: center; color: #6c757d;">æœªæ‰¾åˆ°ç›¸å…³äº§å“</div>';
                } else {
                    resultsContainer.innerHTML = results.map(product => `
                        <div class="search-result-item" onclick="selectProduct(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                            <div class="search-result-name">${product.name}</div>
                            <div class="search-result-details">
                                æ¡ç : ${product.barcode} | ç±»åˆ«: ${product.category_name || 'æœªåˆ†ç±»'}
                                <span class="search-result-stock ${product.stock <= product.min_stock ? 'low' : 'normal'}">
                                    åº“å­˜: ${product.stock}
                                </span>
                            </div>
                            ${operationMode === 'batch' ? 
                                `<button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); addToBatch(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                                    â• æ·»åŠ åˆ°æ‰¹é‡
                                </button>` : ''
                            }
                        </div>
                    `).join('');
                }
                
                resultsContainer.style.display = 'block';
            } catch (error) {
                console.error('Search failed:', error);
                resultsContainer.innerHTML = '<div style="padding: 12px; text-align: center; color: #dc3545;">æœç´¢å¤±è´¥</div>';
                resultsContainer.style.display = 'block';
            }
        }

        function handleQuickSearchInput(event) {
            if (event.key === 'Escape') {
                document.getElementById('quickSearchResults').style.display = 'none';
                document.getElementById('quickSearchInput').blur();
            }
        }

        function selectProduct(product) {
            if (operationMode === 'batch') {
                addToBatch(product);
            } else {
                currentProduct = product;
                updateProductDisplay();
                document.getElementById('quickSearchResults').style.display = 'none';
            }
        }

        function setOperation(operation) {
            console.log('setOperation called with:', operation);
            currentOperation = operation;
            
            // Update button styles
            const btnIn = document.getElementById('btnIn');
            const btnOut = document.getElementById('btnOut');
            
            if (btnIn && btnOut) {
                // Reset both buttons to outline style (gray)
                btnIn.className = 'btn btn-outline btn-lg';
                btnOut.className = 'btn btn-outline btn-lg';
                
                // Set the active button to colored style
                if (operation === 'IN') {
                    btnIn.className = 'btn btn-success btn-lg';
                } else {
                    btnOut.className = 'btn btn-success btn-lg';
                }
                
                console.log('Button styles updated successfully');
            } else {
                console.error('Button elements not found:', { btnIn: !!btnIn, btnOut: !!btnOut });
            }
            
            showMessage(`åˆ‡æ¢åˆ°${operation === 'IN' ? 'å…¥åº“' : 'å‡ºåº“'}æ“ä½œ`, 'info');
        }

        function updateProductDisplay() {
            if (!currentProduct) {
                document.getElementById('productDisplay').style.display = 'none';
                document.getElementById('noProductDisplay').style.display = 'block';
                return;
            }
            
            document.getElementById('productDisplay').style.display = 'block';
            document.getElementById('noProductDisplay').style.display = 'none';
            
            document.getElementById('productName').textContent = currentProduct.name;
            document.getElementById('productBarcode').textContent = currentProduct.barcode;
            document.getElementById('productCategory').textContent = currentProduct.category_name || 'æœªåˆ†ç±»';
            document.getElementById('productLocation').textContent = currentProduct.location || 'æœªè®¾ç½®';
            
            const stockElement = document.getElementById('productStock');
            stockElement.textContent = currentProduct.stock;
            stockElement.className = `product-field-value stock-value ${currentProduct.stock <= currentProduct.min_stock ? 'low' : 'normal'}`;
        }

        function increaseQuantity() {
            const input = document.getElementById('quantityInput');
            input.value = parseInt(input.value) + 1;
        }

        function decreaseQuantity() {
            const input = document.getElementById('quantityInput');
            const newValue = Math.max(1, parseInt(input.value) - 1);
            input.value = newValue;
        }

        async function executeTransaction() {
            if (!currentProduct) {
                showMessage('è¯·å…ˆé€‰æ‹©äº§å“', 'error');
                return;
            }
            
            const quantity = parseInt(document.getElementById('quantityInput').value);
            if (!quantity || quantity < 1) {
                showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°é‡', 'error');
                return;
            }
            
            const operationText = currentOperation === 'IN' ? 'å…¥åº“' : 'å‡ºåº“';
            
            if (!confirm(`ç¡®å®šè¦æ‰§è¡Œ${operationText}æ“ä½œå—ï¼Ÿ\n\näº§å“: ${currentProduct.name}\næ•°é‡: ${quantity}`)) {
                return;
            }
            
            try {
                showMessage(`æ­£åœ¨æ‰§è¡Œ${operationText}æ“ä½œ...`, 'info');
                
                const requestData = {
                    product_id: currentProduct.id,
                    type: currentOperation,
                    quantity: quantity,
                    requester_name: 'ç³»ç»Ÿæ“ä½œ',
                    requester_department: 'ä»“åº“ç®¡ç†',
                    purpose: `${operationText}æ“ä½œ`
                };
                
                console.log('Sending transaction request:', requestData);
                
                await apiRequest('/transactions', {
                    method: 'POST',
                    body: JSON.stringify(requestData)
                });
                
                showMessage(`${operationText}æ“ä½œæˆåŠŸï¼`, 'success');
                
                // Reset quantity
                document.getElementById('quantityInput').value = 1;
                
                // Refresh data
                await loadProducts();
                await loadTransactions();
                await loadStats();
                
                // Update current product info
                const updatedProduct = await apiRequest(`/products/${currentProduct.id}`);
                currentProduct = updatedProduct;
                updateProductDisplay();
                
            } catch (error) {
                console.error('Transaction failed:', error);
                showMessage('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        // Hide search results when clicking outside
        // Signature functionality
        let signatureCanvas = null;
        let signatureCtx = null;
        let isDrawing = false;
        let signatureData = null;

        function initSignature() {
            signatureCanvas = document.getElementById('signatureCanvas');
            if (!signatureCanvas) return;
            
            signatureCtx = signatureCanvas.getContext('2d');
            
            // Set up canvas for drawing
            signatureCtx.strokeStyle = '#000';
            signatureCtx.lineWidth = 2;
            signatureCtx.lineCap = 'round';
            signatureCtx.lineJoin = 'round';
            
            // Mouse events
            signatureCanvas.addEventListener('mousedown', startDrawing);
            signatureCanvas.addEventListener('mousemove', draw);
            signatureCanvas.addEventListener('mouseup', stopDrawing);
            signatureCanvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events for mobile
            signatureCanvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                signatureCanvas.dispatchEvent(mouseEvent);
            });
            
            signatureCanvas.addEventListener('touchmove', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                signatureCanvas.dispatchEvent(mouseEvent);
            });
            
            signatureCanvas.addEventListener('touchend', function(e) {
                e.preventDefault();
                const mouseEvent = new MouseEvent('mouseup', {});
                signatureCanvas.dispatchEvent(mouseEvent);
            });
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = signatureCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            signatureCtx.beginPath();
            signatureCtx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = signatureCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            signatureCtx.lineTo(x, y);
            signatureCtx.stroke();
        }

        function stopDrawing() {
            if (!isDrawing) return;
            isDrawing = false;
            
            // Save signature data
            signatureData = signatureCanvas.toDataURL();
        }

        function clearSignature() {
            if (!signatureCanvas || !signatureCtx) return;
            
            signatureCtx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
            signatureData = null;
            showMessage('ç­¾åå·²æ¸…é™¤', 'info');
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing application...');
            
            // Test if all functions exist
            console.log('Function availability:', {
                setOperation: typeof setOperation,
                setOperationMode: typeof setOperationMode,
                showMessage: typeof showMessage,
                switchPage: typeof switchPage
            });
            
            // Initialize signature functionality
            initSignature();
            
            // Initialize default states
            setOperation('IN');
            setOperationMode('single');
            
            // Test button functionality
            console.log('Testing button elements...');
            const btnIn = document.getElementById('btnIn');
            const btnOut = document.getElementById('btnOut');
            const singleMode = document.getElementById('singleMode');
            const batchMode = document.getElementById('batchMode');
            
            console.log('Button elements found:', {
                btnIn: !!btnIn,
                btnOut: !!btnOut,
                singleMode: !!singleMode,
                batchMode: !!batchMode
            });
            
            // Add additional event listeners to buttons (backup)
            if (btnIn) {
                btnIn.addEventListener('click', function() {
                    console.log('IN button clicked via event listener');
                    setOperation('IN');
                });
            }
            
            if (btnOut) {
                btnOut.addEventListener('click', function() {
                    console.log('OUT button clicked via event listener');
                    setOperation('OUT');
                });
            }
            
            if (singleMode) {
                singleMode.addEventListener('click', function() {
                    console.log('Single mode button clicked via event listener');
                    setOperationMode('single');
                });
            }
            
            if (batchMode) {
                batchMode.addEventListener('click', function() {
                    console.log('Batch mode button clicked via event listener');
                    setOperationMode('batch');
                });
            }
            
            // Initialize page
            if (typeof switchPage === 'function') {
                switchPage('scanner');
            }
        });

        document.addEventListener('click', function(event) {
            const searchBox = document.querySelector('.search-box');
            const resultsContainer = document.getElementById('quickSearchResults');
            
            if (!searchBox.contains(event.target)) {
                resultsContainer.style.display = 'none';
            }
        });
    </script>
</body>
</html>